> :speech_balloon: Deixe o seu feedback sobre este roteiro no rodap√©. [^1] 
![](https://eni.bb.com.br/eni1/matomo.php?idsite=469&amp;rec=1&amp;url=https://fontes.intranet.bb.com.br/dev/publico/roteiros/-/blob/master/release/referencias/release_aplicacao_nuvembb.md&amp;action_name=release/referencias/release_aplicacao_nuvembb)

# Release de aplica√ß√£o da Nuvem BB

O processo de release de aplicativos da Nuvem BB √© alinhado com o [terceiro princ√≠pio](https://12factor.net/pt_br/config) dos Twelve Factors, que prop√µe que os pr√≥prios desenvolvedores configurem o ambiente de execu√ß√£o da aplica√ß√£o. Ap√≥s, essa configura√ß√£o deve ser armazenada e versionada. Para isso, √© criado um reposit√≥rio de c√≥digo espec√≠fico para cada ambiente de execu√ß√£o do Banco, identificados como DES (desenvolvimento), HML (homologa√ß√£o) e PRD (produ√ß√£o), al√©m do reposit√≥rio principal do c√≥digo fonte. O Git √© a ferramenta utilizada para controlar o versionamento.

A configura√ß√£o do ambiente de execu√ß√£o da aplica√ß√£o √© essencialmente gerenciada por dois arquivos: o *requirements.yaml* e o *values.yaml*. O primeiro descreve as depend√™ncias necess√°rias, enquanto o segundo permite a parametriza√ß√£o dos valores definidos por essas depend√™ncias. No Banco, essas depend√™ncias s√£o chamadas de *Charts*. Este roteiro apresenta detalhes da configura√ß√£o dos recursos fornecidos pelo chart **BBAplic**. Esse chart e os recursos dele s√£o fundamentais para a maioria das aplica√ß√µes da Nuvem BB, permitindo a integra√ß√£o do servi√ßo com o ambiente de execu√ß√£o de aplicativos do Banco.

## BBAplic

O [BB Aplic](https://charts.nuvem.bb.com.br/charts/bb-cloud/bb-aplic) √© o chart padr√£o para aplica√ß√µes em cont√™iner desenvolvidas pelo Banco do Brasil. Por ser uma PaaS (plataforma como servi√ßo), ele incorpora uma s√©rie de elementos essenciais do Kubernetes, relacionados no quadro abaixo. 

| Elemento | Defini√ß√£o | Usabilidade | Observa√ß√£o |
| -- | -- | -- | -- | 
| Service | √â um recurso que unifica um conjunto de portas fornecidas pela aplica√ß√£o, permitindo sua utiliza√ß√£o em m√∫ltiplas inst√¢ncias como um √∫nico recurso. | Em uma aplica√ß√£o, um Service pode agrupar as inst√¢ncias de um microservi√ßo. Assim, independentemente de quantas inst√¢ncias est√£o em execu√ß√£o, os usu√°rios sempre se conectam ao mesmo Service, que distribui as solicita√ß√µes entre elas de forma balanceada.| Nos ambientes de desenvolvimento e homologa√ß√£o, defina somente um pod (1 r√©plica) para atendimento. <br> Para o ambiente de produ√ß√£o √© recomendado pelo menos 3 r√©plicas. Ap√≥s monitorar o consumo (tr√°fego/mem√≥ria/CPU), voc√™ pode redimensionar o n√∫mero de r√©plicas de acordo com a necessidade. |
| HPA (Horizontal Pod Autoscaling) | √â um recurso que ajusta automaticamente o n√∫mero de pods em execu√ß√£o com base na carga de trabalho atual do cluster, promovendo alta disponibilidade e resili√™ncia das aplica√ß√µes. | Em uma aplica√ß√£o, quando o tr√°fego aumenta, o HPA pode adicionar mais pods automaticamente para lidar com a demanda extra. √Ä medida que o tr√°fego diminui, o HPA escala para baixo, reduzindo o n√∫mero de pods para economizar recursos. | Se sua aplica√ß√£o for uma exce√ß√£o, ao habilitar o HPA ser√° necess√°rio definir os n√∫meros m√≠nimo e m√°ximo de r√©plicas, juntamente com os percentuais de mem√≥ria e CPU que atuar√£o como gatilho para o autoescalonamento. |
| NodeSelector | √â um recurso que atribui pods a n√≥s espec√≠ficos com base em labels associadas aos n√≥s e aos pods. | A estrutura atual permite a aloca√ß√£o de pods em n√≥s dentro dos clusters K8s apenas com a declara√ß√£o **nodeSelector: {}**. Por padr√£o, deve vir vazio.| N√£o h√° uma lista p√∫blica das labels dos nodes. Em casos espec√≠ficos de aplica√ß√µes que requerem nodes espec√≠ficos, os roteiros disponibilizados no reposit√≥rio Git p√∫blico detalham quais labels devem ser adicionadas para garantir a configura√ß√£o adequada do ambiente. <br> Exemplo de configura√ß√£o espec√≠fica - suporte ao servi√ßo de SMTP: **acesso.node.k8s.bb/smtp: true**. |
| Liveness Probe | √â uma configura√ß√£o que verifica se um cont√™iner est√° em execu√ß√£o e saud√°vel. | Ao configurar o Liveness Probe em uma aplica√ß√£o, o Kubernetes verifica periodicamente o endpoint **/health/live** para garantir que o cont√™iner esteja em execu√ß√£o e saud√°vel. Se o cont√™iner n√£o responder ou responder com erro, o Kubernetes reinicia o cont√™iner para restaurar sua sa√∫de. | **initialDelaySeconds:** 120 <br> **httpGet-Path:** /health/live <br> **httpGet-Port:** 8080 ou conforme a porta que o seu cont√™iner docker exp√µe. <br> **periodSeconds:** 10 <br> **timeoutSeconds:** 5 <br> **failureThreshold:** 6 <br> **successThreshold:** 1 |
| Readiness Probe | √â uma configura√ß√£o que verifica se um cont√™iner est√° pronto para atender solicita√ß√µes de rede. | Ao configurar o Readiness Probe em uma aplica√ß√£o, o Kubernetes verifica periodicamente o endpoint **/health/ready** para garantir que a aplica√ß√£o esteja pronta para atender, permitindo que o tr√°fego de rede seja direcionado para o cont√™iner somente quando estiver pronto. | **initialDelaySeconds:** 120 <br> **httpGet-Path:** /health/ready <br> **httpGet-Port:** 8080  ou de acordo com a porta que o seu cont√™iner docker exp√µe. <br> **periodSeconds:** 10 <br> **timeoutSeconds:** 5 <br> **failureThreshold:** 6 <br> **successThreshold:** 1 |
| Ingress | √â um recurso que gerencia o acesso externo aos servi√ßos em um cluster, normalmente HTTP. | Um Ingress possibilita o direcionamento do tr√°fego para diferentes ambientes, como produ√ß√£o e teste, dentro do cluster Kubernetes, utilizando regras de roteamento. | Caso o seu Service tenha a propriedade **name** declarada, voc√™ precisa configurar a se√ß√£o **paths** do Ingress, fazendo refer√™ncia ao nome do servi√ßo e √† porta correspondente. <br> Confira o [chart bb-aplic](https://charts.nuvem.bb.com.br/charts/bb-cloud/bb-aplic) para visualizar os valores padr√£o dos par√¢metros de configura√ß√£o do objeto Ingress. <br> Confira o [chart dnsservice](https://charts.nuvem.bb.com.br/charts/bb-cloud/dnsservice) para visualizar os padr√µes de nomenclatura de DNS. |
| Curi√≥ | √â um cont√™iner Docker capaz de prover, consumir, publicar e escutar opera√ß√µes do cat√°logo de opera√ß√µes IIB atrav√©s de HTTP REST para sua aplica√ß√£o. | Ao configurar o Curi√≥, √© poss√≠vel definir em quais opera√ß√µes ele atua como Consumidor, utilizando dados de outras opera√ß√µes, e em quais ele atua como Provedor, fornecendo dados para outras opera√ß√µes do sistema. | Confira o [README do Curi√≥](https://fontes.intranet.bb.com.br/iib/publico/iib-container/iib-curio/iib-curio/-/blob/master/README.md) para informa√ß√µes sobre as configura√ß√µes. |
| Service Monitor | √â a maneira pela qual seu microsservi√ßo se comunica com a stack de Monitora√ß√£o associada √† sua sigla. | Ao configurar o monitoramento dentro de um namespace espec√≠fico, o Service Monitor acompanha e registra m√©tricas relacionadas ao desempenho e disponibilidade dos recursos dentro do namespace. | Confira o [arquivo YAML](https://fontes.intranet.bb.com.br/sgs/publico/plataforma-monitoracao/-/blob/master/roteiros/AppD_Instrumentacao_aplicacoes_rancher.md#valuesyaml) para visualizar as labels esperadas pelo Prometheus nas configura√ß√µes de Service Monitor no chart do bb-aplic da aplica√ß√£o. | 

**Tags:** #bbaplic #charts #dns

## Precisa de ajuda?
Em caso de problemas na execu√ß√£o de qualquer roteiro, abra uma [nova issue](https://fontes.intranet.bb.com.br/dev/publico/atendimento/-/issues) e relate a situa√ß√£o. O time de atendimento da devCloud est√° dispon√≠vel para auxiliar! 

## Este roteiro foi √∫til?

[^1]: [üëçüëé](http://feedback.dev.intranet.bb.com.br/?origem=roteiros&url_origem=fontes.intranet.bb.com.br/dev/publico/roteiros/-/blob/master/release/referencias/release_aplica√ß√£o_nuvembb.md&internalidade=release/referencias/release_aplica√ß√£o_nuvembb)
